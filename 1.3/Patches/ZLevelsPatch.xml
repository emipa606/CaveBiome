<?xml version="1.0" encoding="utf-8"?>
<Patch>
  <Operation Class="PatchOperationConditional">
    <success>Always</success>
    <xpath>/Defs/MapGeneratorDef[defName="ZL_Underground"]</xpath>
    <match Class="PatchOperationSequence">
      <operations>
        <li Class="PatchOperationAdd">
          <xpath>/Defs/MapGeneratorDef[defName="ZL_Underground"]/genSteps</xpath>
          <value>
            <li>CaveElevation</li>
            <li>CaveRiver</li>
            <li>CaveRoof</li>
            <li>CaveInitializeWeatherAndLight</li>
            <li>Plants</li>
          </value>
        </li>
      </operations>
    </match>
  </Operation>
  <Operation Class="PatchOperationConditional">
    <success>Always</success>
    <xpath>/Defs/BiomeDef[defName="ZL_UndegroundBiome"]</xpath>
    <match Class="PatchOperationReplace">
      <xpath>/Defs/MapGeneratorDef[defName="ZL_UndegroundBiome"]</xpath>
      <value>
        <BiomeDef>
          <defName>Underground</defName>
          <label>cave</label>
          <description>Deep under the surface, millenia after millenia, the wind, water and lava shape gigantic cave networks. Only ways in and out are through labyrinthic endless galleries or bright cave wells. A rich fauna seek shelter and food in these galleries... or just get lost like you.</description>
          <workerClass>CaveBiome.BiomeWorker_Cave</workerClass>
          <animalDensity>3.0</animalDensity>
          <plantDensity>0</plantDensity>
          <texture>World/Biomes/Cave</texture>
          <settlementSelectionWeight>0</settlementSelectionWeight>
          <allowRivers>false</allowRivers>
          <soundsAmbient>
            <li>AmbientNightInsects_Standard</li>
          </soundsAmbient>
          <diseaseMtbDays>45</diseaseMtbDays>
          <diseases>
            <li>
              <diseaseInc>Disease_Flu</diseaseInc>
              <commonality>100</commonality>
            </li>
            <li>
              <diseaseInc>Disease_Plague</diseaseInc>
              <commonality>100</commonality>
            </li>
            <li>
              <diseaseInc>Disease_Malaria</diseaseInc>
              <commonality>100</commonality>
            </li>
            <li>
              <diseaseInc>Disease_FibrousMechanites</diseaseInc>
              <commonality>30</commonality>
            </li>
            <li>
              <diseaseInc>Disease_SensoryMechanites</diseaseInc>
              <commonality>30</commonality>
            </li>
            <li>
              <diseaseInc>Disease_GutWorms</diseaseInc>
              <commonality>50</commonality>
            </li>
            <li>
              <diseaseInc>Disease_MuscleParasites</diseaseInc>
              <commonality>50</commonality>
            </li>
          </diseases>
          <terrainsByFertility>
            <li>
              <terrain>Soil</terrain>
              <min>-999</min>
              <max>0.87</max>
            </li>
            <li>
              <terrain>SoilRich</terrain>
              <min>0.87</min>
              <max>999</max>
            </li>
          </terrainsByFertility>
          <terrainPatchMakers>
            <li>
              <perlinFrequency>0.015</perlinFrequency>
              <thresholds>
                <li>
                  <terrain>SoilRich</terrain>
                  <min>0.73</min>
                  <max>0.80</max>
                </li>
                <li>
                  <terrain>Mud</terrain>
                  <min>0.80</min>
                  <max>0.93</max>
                </li>
                <li>
                  <terrain>WaterShallow</terrain>
                  <min>0.93</min>
                  <max>1.06</max>
                </li>
                <li>
                  <terrain>WaterDeep</terrain>
                  <min>1.06</min>
                  <max>999</max>
                </li>
              </thresholds>
            </li>
          </terrainPatchMakers>
          <baseWeatherCommonalities>
            <CaveCalm>18</CaveCalm>
            <CaveStorm>4</CaveStorm>
            <CaveFog>8</CaveFog>
            <CaveHardSnow>4</CaveHardSnow>
          </baseWeatherCommonalities>
          <wildPlants>
            <DevilTongue>0.8</DevilTongue>
            <StoneGrass>6.9</StoneGrass>
            <CaveVine>0.5</CaveVine>
            <CaveLace>0.5</CaveLace>
          </wildPlants>
          <wildAnimals>
            <Rat>3</Rat>
            <Megascarab>2</Megascarab>
            <Boomrat>1.5</Boomrat>
            <Spelopede>1.2</Spelopede>
            <Warg>0.5</Warg>
            <Megasloth>0.4</Megasloth>
            <Bear_Grizzly>0.3</Bear_Grizzly>
            <Squirrel>0.2</Squirrel>
            <Tortoise>0.2</Tortoise>
            <Lynx>0.2</Lynx>
            <WildBoar>0.1</WildBoar>
            <Cobra>0.05</Cobra>
            <Raccoon>0.03</Raccoon>
          </wildAnimals>
          <allowedPackAnimals>
            <li>Muffalo</li>
          </allowedPackAnimals>
        </BiomeDef>
      </value>
    </match>
  </Operation>
</Patch>
